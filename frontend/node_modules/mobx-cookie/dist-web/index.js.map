{"version":3,"file":"index.js","sources":["../dist-src/mobx-cookie.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-invalid-this -- this is okay in class properties here */\n/* eslint-disable no-underscore-dangle -- using underscores to denote internal properties */\n/**\n * @file Syncs a cookie's value with a MobX observable, allowing observers to\n * react when it changes.\n * @author Will Stone\n * @license MIT\n */\n// A simple, lightweight JavaScript API for handling browser cookies\nimport * as jsCookie from 'js-cookie';\n// Simple, scalable state management\nimport { makeAutoObservable } from 'mobx';\nconst DAY_IN_MS = 86400000;\n/**\n * Expires To Milliseconds\n * Internal function to convert a js-cookie expires value to milliseconds.\n */\nconst expiresToMs = (expires) => {\n    if (typeof expires === 'number') {\n        return expires * DAY_IN_MS;\n    }\n    const nowInMs = Date.now();\n    return Number(expires) - nowInMs;\n};\n/**\n * Expires To Date Time\n * Internal function to convert a js-cookie expires value to string date-time.\n */\nconst expiresToDateTime = (expires) => {\n    if (typeof expires === 'number') {\n        return new Date(Date.now() + expires * DAY_IN_MS).toString();\n    }\n    return expires;\n};\nclass MobxCookie {\n    constructor(name) {\n        this.value = undefined;\n        this._timeout = undefined;\n        makeAutoObservable(this);\n        // name of set cookie\n        this._name = name;\n        this.value = jsCookie.get(name);\n        // Sync Timeout\n        // Start timer if an _expires_ cookie exists.\n        const expires = jsCookie.get(`${this._name}-expires`);\n        if (expires) {\n            const ms = expiresToMs(new Date(expires));\n            this._timeout = setTimeout(() => this.remove(), ms);\n        }\n    }\n    /**\n     * Set\n     * Set the value (and optional options) of the cookie. Also starts the\n     * removal timer if options.expires is set\n     */\n    set(value, options = {}) {\n        if (this._timeout) {\n            clearTimeout(this._timeout);\n        }\n        this._timeout = undefined;\n        this.value = value;\n        jsCookie.set(this._name, this.value, options);\n        if (options.expires) {\n            // set _expires_ cookie, so that timer can be synced on reload.\n            const expires = expiresToDateTime(options.expires);\n            jsCookie.set(`${this._name}-expires`, expires, {\n                expires: options.expires,\n            });\n            const ms = expiresToMs(options.expires);\n            this._timeout = setTimeout(() => this.remove(), ms);\n        }\n    }\n    /**\n     * Remove\n     * Remove the cookie and reset the observable and timer\n     */\n    remove() {\n        if (this._timeout) {\n            clearTimeout(this._timeout);\n        }\n        this._timeout = undefined;\n        this.value = undefined;\n        jsCookie.remove(this._name);\n        jsCookie.remove(`${this._name}-expires`);\n    }\n}\nexport default MobxCookie;\n"],"names":["jsCookie.get","jsCookie.set","jsCookie.remove"],"mappings":"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"}